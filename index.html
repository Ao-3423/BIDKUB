<!doctype html>
<html lang="th">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>BIDKUB</title>
    <link rel="icon" href="imgs/Bidkub.png" type="image/png" />

    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">

    <!-- Main CSS -->
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="app">

        <!-- Header -->
        <header class="header">
            <div class="brand">
                <img src="imgs/Bidkub.png" alt="Bidkub Logo" class="logo-img">
                <div class="brand-text">
                    <h1>BIDKUB</h1>
                    <p class="sub">Personal Pocket Book</p>
                </div>
            </div>
            <div class="version">v1.0</div>
        </header>

        <!-- MAIN -->
        <main class="grid">

            <!-- Add person -->
            <section class="card">
                <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h2>
                <div class="row add-person-row">
                    <input id="personName" type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠ (‡πÄ‡∏ä‡πà‡∏ô ‡∏™‡∏°‡∏ä‡∏≤‡∏¢)">
                    <button id="addPersonBtn" class="btn blue">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>
                <div id="peopleList" class="muted small"></div>
            </section>

            <!-- Add transaction -->
            <section class="card" id="addTxnSection">

                <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</h2>

                <input id="txnDesc" type="text" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (‡πÄ‡∏ä‡πà‡∏ô ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏¢‡πá‡∏ô)" style="margin-bottom:10px;">

                <div class="row" style="margin-bottom:10px;">
                    <input id="txnAmount" type="number" inputmode="decimal" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (THB)">
                    <select id="txnPayer">
                        <option value="">‡∏ú‡∏π‡πâ‡∏à‡πà‡∏≤‡∏¢</option>
                    </select>
                </div>

                <label class="muted small">‡∏ß‡∏¥‡∏ò‡∏µ‡∏´‡∏≤‡∏£</label>
                <select id="splitMode" style="margin-top:6px;">
                    <option value="equal">‡∏´‡∏≤‡∏£‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô</option>
                    <option value="participants">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏£</option>
                    <option value="custom">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏≠‡∏á</option>
                </select>

                <div id="participantsBox" class="sub-box">
                    <h3 class="muted small">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏£</h3>
                    <div id="participantsCheckboxes"></div>
                </div>

                <div id="customSharesBox" class="sub-box" style="display:none;">
                    <h3 class="muted small">‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏±‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å</h3>
                    <div id="customShares"></div>
                    <p class="muted small" style="margin-top:6px;">
                        * ‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡πÄ‡∏≠‡∏á ‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÉ‡∏´‡πâ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                    </p>
                </div>

                <button id="addTxnBtn" class="btn full" style="margin-top:10px;">
                    ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£
                </button>
            </section>

            <!-- Transactions list -->
            <section class="card" id="reportArea">
                <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                <ul id="txnList" class="list"></ul>

                <hr style="margin:12px 0">

                <h2>‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</h2>
                <div id="summaryBalances" class="small"></div>

                <hr style="margin:12px 0">

                <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡∏´‡∏ô‡∏µ‡πâ</h2>
                <ul id="settlementList" class="list"></ul>
            </section>

            <!-- Import / Export -->
            <section class="card">
                <h2>‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ / ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>

                <div class="row" style="gap: 8px;">
                    <button id="exportBtn" class="btn" style="flex: 1;">
                        ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å JSON
                    </button>

                    <label class="import-btn btn"
                        style="flex: 1; text-align:center; display:flex; justify-content:center; align-items:center;">
                        ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ JSON
                        <input type="file" id="importFile" accept=".json" hidden>
                    </label>
                </div>
            </section>

            <!-- PDF -->
            <section class="card">
                <h2>‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h2>
                <button id="exportPdfBtn" class="btn full">
                    ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô PDF
                </button>
            </section>

            <!-- Clear -->
            <section class="card">
                <h2 class="muted">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h2>
                <button id="clearBtn" class="btn full red">
                    ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                </button>
            </section>

        </main>
    </div>

    <!-- PDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <!-- JS -->
    <script src="app.js"></script>
<script>
document.getElementById("exportPdfBtn").addEventListener("click", async () => {
    const element = document.getElementById("reportArea");

    if (!element || element.innerText.trim() === "") {
        Swal.fire({
            icon: "warning",
            title: "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•",
            text: "‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å PDF",
        });
        return;
    }

    // üî• ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î PDF
    document.body.classList.add("pdf-export");

    await new Promise(resolve => setTimeout(resolve, 300));

    const opt = {
        margin: 10,
        filename: 'BIDKUB-report.pdf',
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: { scale: 2, scrollY: 0 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    };

    await html2pdf().set(opt).from(element).save();

    // üî• ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î PDF (UI ‡∏Å‡∏•‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°)
    document.body.classList.remove("pdf-export");
});
</script>


</body>

</html>
